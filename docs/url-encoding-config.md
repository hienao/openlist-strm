# URL 编码配置指南

本文档介绍如何配置和使用 STRM 文件的 URL 编码功能，以解决特殊字符和中文路径的兼容性问题。

## 功能概述

URL 编码功能允许您根据需要选择是否对 STRM 文件中的 URL 进行编码：

- **开启编码**：确保特殊字符和中文字符在所有媒体服务器中都能正常工作
- **关闭编码**：保持 URL 的原始状态，适用于 ASCII 字符为主的环境

## 配置方法

### 在任务中配置

1. **创建或编辑任务**
   - 进入任务管理页面
   - 点击"添加任务"或选择现有任务进行编辑

2. **找到编码选项**
   - 在任务配置表单中找到"URL 编码设置"部分
   - 可以看到以下选项：

```
□ 启用 URL 编码
   建议在以下情况开启：
   - 路径包含中文字符
   - 路径包含特殊字符（如空格、&、?等）
   - 媒体服务器对特殊字符敏感
```

3. **根据需要设置**
   - ✅ **勾选**：启用 URL 编码
   - ❌ **不勾选**：禁用 URL 编码

### 全局默认设置

在系统设置中可以配置全局默认行为：

1. 进入"系统设置"页面
2. 找到"任务配置默认值"部分
3. 设置"默认启用 URL 编码"选项

## 使用场景和建议

### 推荐开启编码的场景

1. **中文媒体库**
   - 文件名或路径包含中文字符
   - 媒体服务器对中文支持不完善

2. **特殊字符路径**
   - 路径包含空格：`/path/to/my movie/`
   - 路径包含特殊字符：`/path/to/movie & series/`
   - 路径包含符号：`/path/to/movie (2023)/`

3. **多环境兼容**
   - 需要在不同的媒体服务器间使用
   - 确保最大兼容性

### 可以关闭编码的场景

1. **纯英文环境**
   - 所有文件名都是 ASCII 字符
   - 不包含特殊字符

2. **已知良好环境**
   - 媒体服务器对原始 URL 支持良好
   - 之前没有出现过编码问题

3. **性能考虑**
   - 处理大量文件时减少编码开销
   - 确保路径格式符合要求

## 编码效果对比

### 原始 URL（未编码）
```
http://192.168.1.100:8080/path/to/电影/复仇者联盟 (2023).mp4
```

### 编码后的 URL
```
http://192.168.1.100:8080/path/to/%E7%94%B5%E5%BD%B1/%E5%A4%8D%E4%BB%87%E8%80%85%E8%81%94%E7%9B%9F%20%282023%29.mp4
```

## 常见问题

### Q: 启用编码后文件无法播放？
A: 可能的原因：
- 媒体服务器不支持编码格式
- 编码过程出现问题
- 建议关闭编码重试

### Q: 不编码中文路径无法播放？
A: 这正是编码功能要解决的问题：
- 开启 URL 编码
- 确保媒体服务器支持标准 URL 编码
- 大多数现代媒体服务器都支持

### Q: 如何验证编码是否正确？
A: 可以通过以下方式验证：
1. 查看生成的 STRM 文件内容
2. 使用 URL 解码工具验证
3. 在浏览器中测试 URL 是否能正常访问

### Q: 已有任务如何更改编码设置？
A: 操作步骤：
1. 编辑现有任务
2. 修改 URL 编码设置
3. 保存任务
4. 重新执行任务以应用新设置

## 技术细节

### 编码规则
- 使用标准 URL 编码（RFC 3986）
- 只编码必要的字符（非 ASCII 字符和特殊字符）
- 保持 URL 结构的完整性

### 性能影响
- 编码过程会增加少量处理时间
- 对大量文件的影响相对较小
- 建议根据实际需要权衡使用

### 兼容性
- 兼容主流媒体服务器：Plex、Jellyfin、Emby 等
- 符合 HTTP 和 URL 标准
- 向后兼容旧的 STRM 文件格式

## 最佳实践

1. **测试先行**
   - 先对少量文件测试不同设置
   - 验证在您的媒体服务器中的表现
   - 确认后再应用到整个媒体库

2. **一致性原则**
   - 同一类媒体使用相同的编码设置
   - 避免混合使用造成混淆

3. **文档记录**
   - 记录您的编码设置选择
   - 方便后续维护和故障排除

4. **定期检查**
   - 定期检查 STRM 文件是否正常工作
   - 根据需要调整编码设置

---

如果在使用 URL 编码功能时遇到其他问题，请查看 [常见问题](./faq.md) 或联系技术支持。